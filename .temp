-- Outer loop: select distinct transaction numbers to process one transaction at a time
   for txn_id_rec in (
      select distinct transaction_no
        from new_transactions
   ) loop
      begin
         -- Check if transaction number is NULL, raise error if yes
         if txn_id_rec.transaction_no is null then
            raise_application_error(
               -20001,
               'Missing transaction number'
            );
         end if;

         -- Inner loop: process all rows for the current transaction
         for txn_row_rec in (
            select transaction_no,
                   transaction_date,
                   description,
                   account_no,
                   transaction_type,
                   transaction_amount
              from new_transactions
             where transaction_no = txn_id_rec.transaction_no
         ) loop
            dbms_output.put_line('Processing: transaction id: '
                                 || txn_row_rec.transaction_no
                                 || ' amount: '
                                 || txn_row_rec.transaction_amount
                                 || ' type: ' || txn_row_rec.transaction_type);
         end loop;

      exception
         when others then
            dbms_output.put_line('Error: ' || sqlerrm);
            -- Insert error message into error log table
            insert into wkis_error_log ( error_msg ) values ( sqlerrm );
      end;
   end loop;